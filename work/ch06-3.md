<!-- 볼륨 마운트 -->
# 볼륨이란 스토리지의 한 영역을 분할한 것을 말한다.
# 간단히 말하면 하드디스크나 SSD를 분할한 하나의 영역이다.

# 마운트는 "연결하다"라는 의미 그대로 대상을 연결해 운영체제 또는 소프트웨어의 관리하에 두는 일을 말한다.
# 이해하기 쉬운 예로 USB 메모리를 컴퓨터에 꽂으면 띠딩, 하는 소리가 난 다음 폴더가 열리는데, 이것도 USB 메모리가 컴퓨터에 마운트 됏기 때문이다.

# 컨테이너를 종료해도 바로 삭제되지는 않지만 성격상 "쓰고 버려야"하기 때문에 소프트웨어 업그레이드 등의 이유로 언젠가는 삭제된다.
# 이런 상황에서 컨테이너 속에 데이터가 있다면 컨테이너와 함께 데이터도 소멸된다. 컨테이너의 데이터라고 하면 감이 잘 오지 않을 수도 있는데, 예를 들어 컴퓨터나 스마트폰을 새로 샀을때 데이터 이전이 안된다면 매우 곤란할 것이다. 그래서 대개 USB 메모리나 SD카드, 외장 하드에 저장한 후 옮겨서 사용한다.

# 이와 마찬가지로 컨테이너 역시 외부로 데이터를 대피시킨다. 
# 다만 컨테이너는 생성 및 폐기가 매우 빈번하기 때문에 매번 데이터를 옮기는 대신 처음부터 컨테이너 외부에 둔 데이터에 접근해 사용하는 것이 일반적이다.

# 이를 데이터 퍼시스턴시 (data persistency)라고 부른다.
# 이때 데이터를 두는 장소가 마운트된 스토리지 영역이다.

# 스토리지 마운트라고 하면 의미가 모호하기 때문에 관례적으로 '볼륨 마운트'라는 용어를 사용하는데 마운트 대상이 되는 스토리지는 볼륨 외에도 디렉터리나 파일 , 메모리가 될 수도 있다.

<!-- 스토리지 마운트의 종류 -->
# 도커에서 스토리지의 마운트는 두가지 종류가 있다.
# 하나는 볼륨 마운트이고, 다른 하나는 바인드 마운트이다.

<!-- 볼륨 마운트 -->
# 볼륨 마운트는 도커 엔진이 관리하는 영역 내에 만들어진 볼륨을 컨테이너에 디스크 형태로 마운트 한다.
# 이름만으로 관리가 가능하므로 다루기 쉽지만 볼륨에 비해 직접 조작하기 어려우므로 '임시 목적의 사용'이나 '자주 쓰지는 않지만 지우면 안 되는 파일'을 두는 목적으로 많이 사용한다.

#! 도커엔진 수준에 있다.

<!-- 바인드 마운트 -->
# 바인드 마운트는 도커가 설치된 컴퓨터의 문서 폴더 또는 바탕화면 폴더 등 도커 엔진에서 관리하지 않는 영역의 기존 디렉터리를 컨테이너에 마운트하는 방식이다. 디렉터리가 아닌 파일 단위로도 마운트가 가능하다

# 폴더(디렉터리) 속에 파일을 직접 두거나 열어볼 수 있기 때문에 "자주 사용하는 파일을 두는 데 사용" 한다.

#! 운영체제 수준에 있다.

<!-- 두가지 마운트 방식의 차이점 -->
# 두가지 마운트 방식의 차이점은 "간단한지 복잡한지" , "호스트 컴퓨터에서 파일을 다룰 필요가 있는지" , "환경의 의존성을 배제해야 하는지" 로 세가지가 포인트다.

# 볼륨 마운트는 도커 엔진의 관리 하에 있으므로 파일 위치를 신경 쓸 필요가 없다.
# 또한 운영체제에 따라 명령어가 달라지는 등의 의존성 문제도 일어나지 않는다.
# 즉, 볼륨 마운트는 익숙해지면 손쉽게 사용할 수 있다. 그런만큼 도커 제작사에서도 볼륨 마운트 사용을 권장한다.

# 하지만 볼륨 마운트는 도커 컨테이너를 경유ㅠ하지 않고 직접 볼륨에 접근할 방법이 없다. 억지로 수정 , 백업 하려고 해도 깨지거나 복잡한 절차가 필요하다.
# 반면 바인드 마운트는 도커가 관리하지 않는 영역 어디라도 파일을 둘 수 있으며, 기존과 동일한 방식으로 파일을 사용할 수 있으므로 다른 소프트웨어를 사용해 쉽게 편집할 수 있다.

# 이처럼 간편함과 접근 가능 여부에 차이가 있으므로 파일을 직접 편집해야 할 일이 많다면 바인드 마운트를 사용하고, 그렇지 않다면 볼륨 마운트를 사용하면 된다.

#   항목        볼륨 마운트                바인드 마운트
스토리지 영역   볼륨                       디렉터리 또는 파일
물리적 위치     도커 엔진의 관리 영역      어디든지 가능
마운트 절차     볼륨을 생성한 후 마운트    기존 파일 또는 폴더를 마운트
내용 편집       도커 컨테이너를 통해서     일반적인 파일과 같이
백업            절차가 복잡함              일반적인 파일과 같이

# 사실 마운트 방식이 한가지 더 있는데 바로 임시 메모리(tmpfs) 마운트 방식이다
# 임시 메모리 마운트는 디스크가 아닌 주 메모리 영역을 마운트한다. 디스크보다 훨씬 빠른 속도로 읽고 쓰기가 가능하기 때문에 접근 속도를 높일 목적으로 사용하지만 도커 엔진이 정지되거나 호스트가 재부팅하면 소멸한다.

<!-- 스토리지 영역을 마운트하는 커맨드 : run 커맨드의 옵션형태 -->
# 어느 마운트 방식을 사용하든 스토리지 마운트는 run 커맨드의 옵션 형태로 지정한다.
# 마운트하려는 스토리지의 경로가 컨테이너 속 특정 경로와 연결되도록 설정하는 형태다.

# 마운트 대상이 되는 컨테이너 속 위치는 컨테이너의 소프트웨어가 콘텐츠를 저장하는 경로가 되는 경우가 많다. 
# 예를 들어, 아파치라면 '/usr/local/apache/htdocs' 이며, MySQL은 '/var/lib/mysql'이다

# 데이터가 위치하는 경로는 도커 이미지의 참조 문서 등을 보면 알 수 있다.

<!-- 스토리지를 마운트하는 절차 -->
# 스토리지를 마운트하려면 먼저 마운트될 스토리지를 생성해야 한다.
# 볼륨 마운트의 경우 마운트와 동시에 볼륨(스토리지 영역)을 만들 수도 있지만 이 방법은 권장하지 않는다. 마운트 전에 별도로 볼륨을 먼저 생성하는 것이 좋다.

<!-- 스토리지 영역을 만드는 방법 -->
# 바인드 마운트는 원본이 될 폴더(디렉터리) 나 파일을 먼저 만든다. 평소하듯이 폴더를 만들면 된다.

# 볼륨 생성 (볼륨 마운트)
docker volume create 볼륨_이름

# 볼륨 삭제 (볼륨 마운트)
docker volume rm 볼륨_이름

# 볼륨의 상세 정보 출력
docker volume inspect 볼륨_이름

# 주요 하위 커맨드
create - 볼륨을 생성                    -- 생략 불가능
inspect - 볼륨의 상세 정보를 출력       -- 생략 불가능
ls - 볼륨의 목록을 출력                 -- 생략 불가능
prune - 현재 마운트되지 않은 볼륨을 모두 삭제   -- 생략 불가능
rm - 지정한 볼륨을 삭제                 -- 생략 불가능

<!-- 스토리지를 마운트하는 커맨드 -->
# -v 옵션 뒤에 '스토리지 실제 경로' 또는 '볼륨 이름' , '컨테이너 마운트 경로' 순서대로 기재한다. 이들 경로는 콜론(:)을 사용해 구분한다.
# 바인드 마운트는 볼륨을 마운트하지 않지만 볼륨 마운트와 마찬가지로 -v 옵션을 사용한다

# 바인드 마운트 커맨드 예
docker run [(생략)] -v 스토리지_실제경로:컨테이너_마운트_경로 [(생략)]

# 볼륨 마운트 커맨트 예
docker run [(생략)] -v 볼륨_이름:컨테이너_마운트_경로 [(생략)]

